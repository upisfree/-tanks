(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u={}.hasOwnProperty,v=function(a,b){function c(){this.constructor=a}for(var d in b)u.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};for(l={debug:!0,path:"./-tanks/"},Matter.RenderPixi.create=function(a){var b,c;return b={controller:Matter.RenderPixi,element:null,canvas:null,options:{width:800,height:600,background:"#fafafa",wireframeBackground:"#222",enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},c=Matter.Common.extend(b,a),c.context=new PIXI.WebGLRenderer(c.options.width,c.options.height,c.canvas,!1,!0),c.canvas=c.context.view,c.stage=new PIXI.Stage,c.textures={},c.sprites={},c.primitives={},c.spriteBatch=new PIXI.DisplayObjectContainer,c.stage.addChild(c.spriteBatch),Matter.Common.isElement(c.element)?c.element.appendChild(c.canvas):Matter.Common.log('No "render.element" passed, "render.canvas" was not inserted into document.',"warn"),c.canvas.oncontextmenu=c.canvas.onselectstart=function(){return!1},c},Matter.RenderPixi.world=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;for(h=a.render,j=a.world,f=a.map,d=h.context,i=h.stage,g=h.options,b=Matter.Composite.allBodies(j),c=Matter.Composite.allConstraints(j),k=0,n=f.length;n>k;k++)e=f[k],h.spriteBatch.addChildAt(e.sprite,0);for(l=0,o=b.length;o>l;l++)e=b[l],Matter.RenderPixi.body(a,e);for(m=0,p=c.length;p>m;m++)e=c[m],Matter.RenderPixi.constraint(a,e);return d.render(i)},Matter.RenderPixi.body=function(a,b){var c,d,e,f,g,h,i,j;if(d=a.render,c=b.render,f=d.spriteBatch,c.visible){if(c.tank){for(-1===f.children.indexOf(c.tank)&&f.addChild(c.tank),j=c.tank.children,h=0,i=j.length;i>h;h++)e=j[h],e.position.x=b.position.x,e.position.y=b.position.y;c.tank.children[0].rotation=b.angle}return c.sprite&&c.sprite.texture?(g="b-"+b.id,e=d.sprites[g],e||(e=d.sprites[g]=Matter.RenderPixi._createBodySprite(d,b)),-1===f.children.indexOf(e)&&f.addChild(e),e.position.x=b.position.x,e.position.y=b.position.y,e.rotation=b.angle):void 0}},Matter.RenderPixi._getTexture=function(a,b){var c;return c=a.textures[b],c||(c=a.textures[b]=PIXI.Texture.fromImage(b)),c},Matter.RenderPixi._createBodySprite=function(a,b){var c,d,e,f;return c=b.render,f=c.sprite.texture,e=Matter.RenderPixi._getTexture(a,f),d=new PIXI.Sprite(e),d.anchor.x=.5,d.anchor.y=.5,d},s=32,r={x:(window.innerWidth/s).toFixed(),y:(window.innerHeight/s).toFixed()},q={x:r.x*s,y:r.y*s},f={position:{x:0,y:0}},m=Matter.Engine.create(document.body,{world:{gravity:{x:0,y:0},bounds:{min:{x:-1/0,y:-1/0},max:{x:1/0,y:1/0}}},enableSleeping:!0,render:{controller:Matter.RenderPixi,options:{width:q.x,height:q.y,wireframes:!1}},map:[]}),n={tanks:{}},b={PLAYER:"player",BOT:"bot",HEDGEHOD:"hedgehog",GROUND:"ground",GRAVEL:"gravel",DIRT:"dirt",GRASS:"grass",PUDDLE:"puddle",SHELL:"shell"},Math.randomInt=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},Math.radiansToDegrees=function(a){return a*(180/Math.PI)},Math.degreesToRadians=function(a){return a*(Math.PI/180)},k=Matter.Vector,k.fromAngle=function(a){return a-=Math.PI/2,{x:Math.cos(a),y:Math.sin(a)}},Array.prototype.remove=function(a){var b,c,d;d=[];for(b in this)c=this[b],d.push(c.i===a.i?this.splice(b,1):void 0);return d},c=function(){function a(a,c,d,e,f){switch(this.x=a,this.y=c,this.rotation=d,this.type=e,this.i=null!=f?f:container.children.length,this.s=new PIXI.Sprite(PIXI.Texture.fromImage("../assets/textures/"+this.type+".png")),this.s.position.x=this.x*s+s/2,this.s.position.y=this.y*s+s/2,this.s.rotation=Math.degreesToRadians(this.rotation),this.s.anchor.x=.5,this.s.anchor.y=.5,m.render.addChild(this.s),this.type){case b.HEDGEHOD:n.hedgehogs.push(this);break;case b.SHELL:n.shells.push(this)}}return a}(),j=function(a){function b(a,c,d,e,f){this.x=a,this.y=c,this.rotation=d,this.type=e,this.lives=f,b.__super__.constructor.call(this,this.x,this.y,this.rotation,this.type)}return v(b,a),b.prototype.move=function(a,b,c){var d,e,f,g,h,i;if(e=Math.degreesToRadians(c),f=container.children[this.i],f.rotation!==e)return this.rotation=c,f.rotation=e,void(container.children[this.i]=f);if(f.position.x+a*s<q.x&&f.position.x+a*s>-1&&f.position.y+b*s<q.y&&f.position.y+b*s>-1){for(this.x+=a,this.y+=b,f.position.x+=a*s,f.position.y+=b*s,i=n.hedgehogs,g=0,h=i.length;h>g;g++)d=i[g],this.x===d.x&&this.y===d.y&&this.applyDamage(1);return container.children[this.i]=f}},b.prototype.applyDamage=function(a){return this.lives-=a,this.lives<=0?this.destroy("Tank was destroyed!"):void 0},b.prototype.destroy=function(a){return this._isAlive=!1,console.log(a)},b.prototype.shoot=function(){return Date.now()-this._lastShoot>=2e3?(new h(this.x,this.y,this.rotation),this._lastShoot=Date.now()):void 0},b.prototype._isAlive=!0,b.prototype._lastShoot=Date.now(),b}(c),h=function(){function a(a){var b,c,d;this.tank=a,d=k.fromAngle(this.tank.body.turretRotation),b=this.tank.body.position.x+20*d.x,c=this.tank.body.position.y+20*d.y,this.body=Matter.Bodies.rectangle(b,c,7,14,{angle:this.tank.body.turretRotation,friction:1,frictionAir:.1,mass:1e3,render:{sprite:{texture:"assets/textures/tanks/shell.png"}}}),this.body.label="shell-"+this.tank.body.id,Matter.Composite.add(m.world,this.body),Matter.Body.applyForce(this.body,{x:0,y:0},k.mult(d,200)),Matter.Body.applyForce(this.tank.body,{x:0,y:0},k.neg(k.mult(d,50))),Matter.Events.on(m,"collisionStart",function(b){var c,d,e,f,g,h;for(e=b.pairs,h=[],f=0,g=e.length;g>f;f++)if(d=e[f],d.bodyA.label.contains("tank")&&d.bodyB.label.contains("shell")){if(Matter.Composite.remove(m.world,d.bodyB),a=n.tanks[d.bodyA.label.replace(/tank-/,"")],!a)break;c=Math.round(100*d.separation),a.lives-=c,h.push(a.lives<=0?a.destroy():void 0)}else h.push(d.bodyA.label.contains("shell")&&d.bodyB.label.contains("shell")?Matter.Composite.remove(m.world,[d.bodyA,d.bodyA]):void 0);return h})}return a}(),e={Cell:function(){function a(a,b,c,d){this.x=a,this.y=b,this.type=c,this.rotation=null!=d?d:0,this.sprite=new PIXI.Sprite(PIXI.Texture.fromImage("assets/textures/map/"+this.type+".png")),this.sprite.position.x=this.x*s+s/2,this.sprite.position.y=this.y*s+s/2,this.sprite.rotation=Math.degreesToRadians(this.rotation),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,m.map.push(this)}return a}(),generate:function(){var a,c,d,f,g,h;for(h=[],c=f=0,g=r.x;g>=0?g>=f:f>=g;c=g>=0?++f:--f)h.push(function(){var f,g,h;for(h=[],d=f=0,g=r.y;g>=0?g>=f:f>=g;d=g>=0?++f:--f)a=Math.randomInt(0,100),h.push(10>a?new e.Cell(c,d,b.GRAVEL):a>10&&20>a?new e.Cell(c,d,b.DIRT):a>20&&30>a?new e.Cell(c,d,b.GRASS):90===a?new e.Cell(c,d,b.PUDDLE):new e.Cell(c,d,b.GROUND));return h}());return h}},i=function(){function a(a,b,c,d,e){var f,g;this.texture=c,this.width=null!=d?d:25,this.height=null!=e?e:23,this.body=Matter.Bodies.rectangle(a,b,this.width,this.height,{friction:1,frictionAir:.1,mass:1e4,render:{tank:null}}),this.body.label="tank-"+this.body.id,this.body.render.tank=new PIXI.DisplayObjectContainer,f=new PIXI.Sprite(PIXI.Texture.fromImage("assets/textures/tanks/"+this.texture+"/base.png")),f.position={x:a,y:b},f.anchor={x:.5,y:.5},g=new PIXI.Sprite(PIXI.Texture.fromImage("assets/textures/tanks/"+this.texture+"/turret.png")),g.position={x:a,y:b},g.anchor={x:.5,y:.73},this.body.render.tank.addChild(f),this.body.render.tank.addChild(g),Matter.Composite.add(m.world,this.body),n.tanks[this.body.id]=this}return a.prototype.move=function(a){return Matter.Body.applyForce(this.body,{x:0,y:0},k.mult(a,10))},a.prototype.shoot=function(){return new h(this),this._lastShoot=Date.now()},a.prototype.destroy=function(){return this._isAlive=!1,delete n.tanks[this.body.id],console.log(this.body.label+" was destroyed!")},a.prototype.lives=100,a.prototype._isAlive=!0,a.prototype._lastShoot=Date.now(),a}(),g=function(a){function b(a,c){b.__super__.constructor.call(this,a,c,"player"),this.enable.keyboard(this),this.enable.mouse(this)}return v(b,a),b.prototype.enable={keyboard:function(a){return Mousetrap.bind(["w","up"],function(){return a.move(k.fromAngle(a.body.angle))}),Mousetrap.bind(["s","down"],function(){return a.move(k.neg(k.fromAngle(a.body.angle)))}),Mousetrap.bind(["a","left"],function(){return Matter.Body.rotate(a.body,Math.degreesToRadians(-2))}),Mousetrap.bind(["d","right"],function(){return Matter.Body.rotate(a.body,Math.degreesToRadians(2))})},mouse:function(a){return window.onmousemove=function(b){return f.position={x:b.x,y:b.y},a.body.render.tank.children[1].rotation=a.body.turretRotation=Math.atan2(a.body.position.y-b.y,a.body.position.x-b.x)-Math.PI/2},window.onclick=function(){return a.shoot()}}},b.prototype.disable={keyboard:function(){return Mousetrap.unbind(["w","up","s","down","a","left","d","right"])},mouse:function(){return window.onmousemove=window.onclick=null}},b.prototype.destroy=function(){return this.disable.keyboard(),this.disable.mouse(),b.__super__.destroy.apply(this,arguments)},b}(i),d=function(c){function d(c,e,f){this.x=c,this.y=e,this.rotation=f,d.__super__.constructor.call(this,this.x,this.y,this.rotation,b.BOT,2),a.enable(this),n.bots.push(this)}return v(d,c),d.prototype.destroy=function(){return a.disable(this),d.__super__.destroy.call(this,"Bye, bot!")},d.prototype._ai=null,d}(i),a={enable:function(a){return a._ai=setInterval(function(){var b,c,d,e;switch(b=+(player.x-a.x),d=+(player.y-a.y),d>b?(c="x",player.x>a.x?e="right":player.x<a.x?e="left":player.x===a.x&&(player.y>a.y?a.move(0,0,180):player.y<a.y&&a.move(0,0,0))):(c="y",player.y>a.y?e="down":player.y<a.y?e="up":player.y===a.y&&(player.x>a.x?a.move(0,0,90):player.x<a.x&&a.move(0,0,270))),e){case"up":a.move(0,-1,0);break;case"right":a.move(1,0,90);break;case"down":a.move(0,1,180);break;case"left":a.move(-1,0,270)}return a.shoot()},500)},disable:function(a){return clearInterval(a._ai)},random:function(a){return a._ai=setInterval(function(){var b;switch(b=Math.randomInt(0,3)){case 0:return a.move(0,-1,0);case 1:return a.move(1,0,90);case 2:return a.move(0,1,180);case 3:return a.move(-1,0,270)}},1e3)}},Matter.Engine.run(m),l.debug===!1&&(o={pixel:new PIXI.PixelateFilter},o.pixel.size={x:3,y:3},m.render.spriteBatch.filters=[o.pixel]),p=t=0;100>=t;p=++t)new i(Math.randomInt(0,q.x),Math.randomInt(0,q.y),"bot");new g(q.x/2,q.y/2),e.generate(),Matter.Events.on(m,"tick",function(){var a,b,c,d;for(a=Matter.Composite.allBodies(m.world),c=0,d=a.length;d>c;c++)b=a[c],b.label.contains("shell")&&b.isSleeping&&Matter.Composite.remove(m.world,b);return l.debug?window.engine=m:void 0})}).call(this);