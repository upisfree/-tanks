(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A={}.hasOwnProperty,B=function(a,b){function c(){this.constructor=a}for(var d in b)A.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};for(i=document.getElementsByTagName("canvas")[0],j=i.getContext("2d"),q=640,s=32,r=q/s,m={all:[],hedgehogs:[],bots:[]},b={PLAYER:"player",BOT:"bot",HEDGEHOD:"hedgehog",GROUND:"ground",GRAVEL:"gravel",DIRT:"dirt",GRASS:"grass",PUDDLE:"puddle"},e={CTRL:17,ALT:18,ESC:27,SPACE:32,ENTER:13,ARROW:{UP:38,LEFT:37,DOWN:40,RIGHT:39},W:87,A:65,S:83,D:68},Math.randomInt=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},h=function(){function a(a,b,c){this.x=a,this.y=b,this.deg=c,0===this.deg&&(this.deg=360)}return a}(),k=function(a,c){var d;return d=new Image,d.src="../textures/"+c+".png",d.onload=function(){var e;return j.save(),c===b.PLAYER||c===b.BOT?(e=Math.PI/180*a.deg,j.translate(a.x+s/2,a.y+s/2),j.rotate(e),j.drawImage(d,-d.width/2,-d.height/2,d.width,d.height)):j.drawImage(d,a.x,a.y),j.restore()}},p=function(){var a,b,c,d,e;for(d=m.all,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(k(new h(a.v.x*s,a.v.y*s,a.v.deg),a.type));return e},c=function(){function a(a,c){this.v=a,this.type=c,this.i=m.all.length,(this.type!==b.PLAYER||this.type!==b.BOT)&&m.all.push(this),this.type===b.HEDGEHOD&&m.hedgehogs.push(this)}return a}(),g=function(a){function c(a,b,c){this.v=a,this.type=b,this.lives=c}return B(c,a),c.prototype.move=function(a){var c,d,e,f,g,h,i,j;if(e=a.x,f=a.y,c=a.deg,c&&(this.v.deg=c),this.v.x+e<r&&this.v.x+e>-1&&this.v.y+f<r&&this.v.y+f>-1){for(this.v.x+=e,this.v.y+=f,m.all[this.i]=this,i=m.all,j=[],g=0,h=i.length;h>g;g++)d=i[g],j.push(this.v.x===d.v.x&&this.v.y===d.v.y&&d.type===b.HEDGEHOD?this.applyDamage(1):void 0);return j}},c.prototype.applyDamage=function(a){return this.lives-=a,this.lives<=0?this.destroy("Tank was destroyed!"):void 0},c.prototype.destroy=function(a){return console.log(a)},c}(c),f=function(c){function d(a){this.v=a,d.__super__.constructor.call(this,this.v,b.PLAYER,3),this.enableControl(),m.all.push(this)}return B(d,c),d.prototype.enableControl=function(){return window.onkeydown=function(a){switch(a.keyCode){case e.ARROW.LEFT:case e.A:return n.move(new h(-1,0,270));case e.ARROW.UP:case e.W:return n.move(new h(0,-1,0));case e.ARROW.RIGHT:case e.D:return n.move(new h(1,0,90));case e.ARROW.DOWN:case e.S:return n.move(new h(0,1,180))}}},d.prototype.disableControl=function(){return window.onkeydown=null},d.prototype.destroy=function(){var b,c,e,f;for(this.disableControl(),f=m.bots,c=0,e=f.length;e>c;c++)b=f[c],a.disable(b),a.random(b);return d.__super__.destroy.call(this,"Bye, sir!")},d}(g),d=function(c){function d(c){this.v=c,d.__super__.constructor.call(this,this.v,b.BOT,2),a.enable(this),m.all.push(this),m.bots.push(this)}return B(d,c),d.prototype.destroy=function(){return a.disable(this),d.__super__.destroy.call(this,"Bye, bot!")},d.prototype._ai=null,d}(g),y=t=0,w=r-1;w>=0?w>=t:t>=w;y=w>=0?++t:--t)for(z=u=0,x=r-1;x>=0?x>=u:u>=x;z=x>=0?++u:--u)new c(new h(y,z,0),b.GROUND),o=Math.randomInt(0,100),10>o&&new c(new h(y,z,0),b.GRAVEL),o>10&&20>o&&new c(new h(y,z,0),b.DIRT),o>20&&30>o&&new c(new h(y,z,0),b.GRASS),90===o&&new c(new h(y,z,0),b.PUDDLE),o>95&&new c(new h(y,z,0),b.HEDGEHOD);for(a={enable:function(a){return a._ai=setInterval(function(){var b,c,d,e;switch(b=+(n.v.x-a.v.x),d=+(n.v.y-a.v.y),d>b?(c="x",n.v.x>a.v.x?e="right":n.v.x<a.v.x?e="left":n.v.x===a.v.x&&(n.v.y>a.v.y?a.move(new h(0,0,180)):n.v.y<a.v.y&&a.move(new h(0,0,0)),console.log("Catch you on x axis"))):(c="y",n.v.y>a.v.y?e="down":n.v.y<a.v.y?e="up":n.v.y===a.v.y&&(n.v.x>a.v.x?a.move(new h(0,0,90)):n.v.x<a.v.x&&a.move(new h(0,0,270)),console.log("Catch you on y axis!"))),e){case"up":return a.move(new h(0,-1,0));case"right":return a.move(new h(1,0,90));case"down":return a.move(new h(0,1,180));case"left":return a.move(new h(-1,0,270))}},500)},disable:function(a){return clearInterval(a._ai)},random:function(a){return a._ai=setInterval(function(){var b;switch(b=Math.randomInt(0,3)){case 0:return a.move(new h(0,-1,0));case 1:return a.move(new h(1,0,90));case 2:return a.move(new h(0,1,180));case 3:return a.move(new h(-1,0,270))}},1e3)}},n=new f(new h(Math.randomInt(0,r-1),Math.randomInt(0,r-1),0)),l=v=0;9>=v;l=++v)new d(new h(Math.randomInt(0,r-1),Math.randomInt(0,r-1),0));setInterval(function(){return p()},16)}).call(this);