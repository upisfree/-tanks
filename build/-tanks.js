(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E={}.hasOwnProperty,F=function(a,b){function c(){this.constructor=a}for(var d in b)E.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};for(w=32,u={x:((window.innerWidth-94)/w).toFixed(),y:((window.innerHeight-94)/w).toFixed()},r={x:u.x*w,y:u.y*w},v=new PIXI.Stage(4138752),j=new PIXI.DisplayObjectContainer,q=new PIXI.autoDetectRenderer(r.x,r.y),document.body.appendChild(q.view),k={hedgehogs:[],bots:[],players:[],shells:[]},b={PLAYER:"player",BOT:"bot",HEDGEHOD:"hedgehog",GROUND:"ground",GRAVEL:"gravel",DIRT:"dirt",GRASS:"grass",PUDDLE:"puddle",SHELL:"shell"},e={CTRL:17,ALT:18,ESC:27,SPACE:32,ENTER:13,ARROW:{UP:38,LEFT:37,DOWN:40,RIGHT:39},W:87,A:65,S:83,D:68},Math.randomInt=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},Math.radiansToDegrees=function(a){return a*(180/Math.PI)},Math.degreesToRadians=function(a){return 0===a&&(a=360),a*(Math.PI/180)},Array.prototype.remove=function(a){var b,c,d;d=[];for(b in this)c=this[b],d.push(c.i===a.i?this.splice(b,1):void 0);return d},n=function(a,b,c,d,e,f){return null==e&&(e=w),null==f&&(f=w),a+e>=c&&c+f>=a&&b+e>=d&&d+f>=b?!0:!1},c=function(){function a(a,c,d,e,f){switch(this.x=a,this.y=c,this.rotation=d,this.type=e,this.i=null!=f?f:j.children.length,this.s=new PIXI.Sprite(PIXI.Texture.fromImage("../assets/textures/"+this.type+".png")),this.s.position.x=this.x*w+w/2,this.s.position.y=this.y*w+w/2,this.s.rotation=Math.degreesToRadians(this.rotation),this.s.anchor.x=.5,this.s.anchor.y=.5,j.addChild(this.s),this.type){case b.HEDGEHOD:k.hedgehogs.push(this);break;case b.SHELL:k.shells.push(this)}}return a}(),h=function(a){function b(a,c,d,e,f){this.x=a,this.y=c,this.rotation=d,this.type=e,this.lives=f,b.__super__.constructor.call(this,this.x,this.y,this.rotation,this.type)}return F(b,a),b.prototype.move=function(a,b,c){var d,e,f,g,h,i;if(e=Math.degreesToRadians(c),f=j.children[this.i],f.rotation!==e)return this.rotation=c,f.rotation=e,void(j.children[this.i]=f);if(f.position.x+a*w<r.x&&f.position.x+a*w>-1&&f.position.y+b*w<r.y&&f.position.y+b*w>-1){for(this.x+=a,this.y+=b,f.position.x+=a*w,f.position.y+=b*w,i=k.hedgehogs,g=0,h=i.length;h>g;g++)d=i[g],this.x===d.x&&this.y===d.y&&this.applyDamage(1);return j.children[this.i]=f}},b.prototype.applyDamage=function(a){return this.lives-=a,this.lives<=0?this.destroy("Tank was destroyed!"):void 0},b.prototype.destroy=function(a){return this._isAlive=!1,console.log(a)},b.prototype.shoot=function(){return Date.now()-this._lastShoot>=2e3?(new g(this.x,this.y,this.rotation),this._lastShoot=Date.now()):void 0},b.prototype._isAlive=!0,b.prototype._lastShoot=Date.now(),b}(c),g=function(a){function c(a,d,e){switch(this.x=a,this.y=d,this.rotation=e,this.rotation){case 0:--this.y;break;case 90:++this.x;break;case 180:++this.y;break;case 270:--this.x}c.__super__.constructor.call(this,this.x,this.y,this.rotation,b.SHELL)}return F(c,a),c}(c),t={speed:2,remove:function(a){return k.shells.remove(a),j.children.splice(a.i,1)},moveAll:function(){var a,b,c,d,e,f,g,h,i;for(g=k.shells,i=[],c=0,e=g.length;e>c;c++){switch(a=g[c],a.rotation){case 0:a.s.position.y-=t.speed;break;case 90:a.s.position.x+=t.speed;break;case 180:a.s.position.y+=t.speed;break;case 270:a.s.position.x-=t.speed}for((a.s.position.x>r.x||a.s.position.x<0||a.s.position.y>r.y||a.s.position.y<0)&&t.remove(a),h=k.bots,d=0,f=h.length;f>d;d++)b=h[d],n(a.s.position.x,a.s.position.y,b.s.position.x,b.s.position.y)===!0&&b._isAlive===!0&&(t.remove(a),b.applyDamage(1));i.push(function(){var c,d,e,f;for(e=k.players,f=[],c=0,d=e.length;d>c;c++)b=e[c],n(a.s.position.x,a.s.position.y,b.s.position.x,b.s.position.y)===!0&&b._isAlive===!0?(t.remove(a),f.push(b.applyDamage(1))):f.push(void 0);return f}())}return i}},x=z=0,C=u.x;C>=0?C>=z:z>=C;x=C>=0?++z:--z)for(y=A=0,D=u.y;D>=0?D>=A:A>=D;y=D>=0?++A:--A)new c(x,y,0,b.GROUND),p=Math.randomInt(0,100),10>p&&new c(x,y,0,b.GRAVEL),p>10&&20>p&&new c(x,y,0,b.DIRT),p>20&&30>p&&new c(x,y,0,b.GRASS),90===p&&new c(x,y,0,b.PUDDLE),p>95&&new c(x,y,0,b.HEDGEHOD);for(f=function(c){function d(a,c,e){this.x=a,this.y=c,this.rotation=e,d.__super__.constructor.call(this,this.x,this.y,this.rotation,b.PLAYER,3),this.enableControl(),k.players.push(this)}return F(d,c),d.prototype.enableControl=function(){var a;return a=this,window.onkeydown=function(b){switch(b.keyCode){case e.ARROW.LEFT:case e.A:return a.move(-1,0,270);case e.ARROW.UP:case e.W:return a.move(0,-1,0);case e.ARROW.RIGHT:case e.D:return a.move(1,0,90);case e.ARROW.DOWN:case e.S:return a.move(0,1,180);case e.SPACE:return a.shoot()}}},d.prototype.disableControl=function(){return window.onkeydown=null},d.prototype.destroy=function(){var b,c,e,f;for(this.disableControl(),f=k.bots,c=0,e=f.length;e>c;c++)b=f[c],b._isAlive===!0&&(a.disable(b),a.random(b));return d.__super__.destroy.call(this,"Bye, sir!")},d}(h),s=function(){return window.container=j},d=function(c){function d(c,e,f){this.x=c,this.y=e,this.rotation=f,d.__super__.constructor.call(this,this.x,this.y,this.rotation,b.BOT,2),a.enable(this),k.bots.push(this)}return F(d,c),d.prototype.destroy=function(){return a.disable(this),d.__super__.destroy.call(this,"Bye, bot!")},d.prototype._ai=null,d}(h),a={enable:function(a){return a._ai=setInterval(function(){var b,c,d,e;switch(b=+(o.x-a.x),d=+(o.y-a.y),d>b?(c="x",o.x>a.x?e="right":o.x<a.x?e="left":o.x===a.x&&(o.y>a.y?a.move(0,0,180):o.y<a.y&&a.move(0,0,0))):(c="y",o.y>a.y?e="down":o.y<a.y?e="up":o.y===a.y&&(o.x>a.x?a.move(0,0,90):o.x<a.x&&a.move(0,0,270))),e){case"up":a.move(0,-1,0);break;case"right":a.move(1,0,90);break;case"down":a.move(0,1,180);break;case"left":a.move(-1,0,270)}return a.shoot()},500)},disable:function(a){return clearInterval(a._ai)},random:function(a){return a._ai=setInterval(function(){var b;switch(b=Math.randomInt(0,3)){case 0:return a.move(0,-1,0);case 1:return a.move(1,0,90);case 2:return a.move(0,1,180);case 3:return a.move(-1,0,270)}},1e3)}},o=new f(Math.randomInt(0,u.x-1),Math.randomInt(0,u.y-1),0),m=B=0;9>=B;m=++B)new d(Math.randomInt(0,u.x-1),Math.randomInt(0,u.y-1),0);l={pixel:new PIXI.PixelateFilter},l.pixel.size.x=l.pixel.size.y=3,j.filters=[l.pixel],v.addChild(j),i=function(){return requestAnimFrame(i),t.moveAll(),s(),q.render(v)},requestAnimFrame(i)}).call(this);